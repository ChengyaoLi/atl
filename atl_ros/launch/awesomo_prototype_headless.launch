<?xml version="1.0"?>
<launch>
  <!-- sync gazebo time with ros -->
  <param name="use_sim_time" value="true" />
  <param name="estimate_frame" value="INERTIAL" />

  <!-- prototype -->
  <param name="sim_mode" value="true" />
  <param name="debug_mode" value="false" />
  <node pkg="prototype_ros" name="prototype_gazebo" type="run_gazebo.sh" output="screen" required="true" />
  <node pkg="prototype_ros" name="prototype_world" type="world_node" output="screen" required="true" />
  <node pkg="prototype_ros" name="prototype_quadrotor" type="quadrotor_node" output="screen" required="true" />
  <node pkg="prototype_ros" name="prototype_camera" type="camera_node" output="screen" required="true">
    <param name="imu_mode" value="true" />
    <param name="imu_topic" value="/atl/gimbal/joint/orientation" />
    <remap from="/prototype/camera/image" to="/atl/camera/image" />
  </node>
  <node pkg="prototype_ros" name="prototype_gimbal" type="gimbal_node" output="screen" required="true" >
    <remap from="/prototype/gimbal/frame/pose" to="/atl/gimbal/frame/pose" />
    <remap from="/prototype/gimbal/joint/orientation" to="/atl/gimbal/joint/orientation" />
    <remap from="/prototype/gimbal/setpoint/attitude" to="/atl/gimbal/setpoint/attitude" />
    <remap from="/prototype/gimbal/track" to="/atl/gimbal/track" />
    <remap from="/prototype/gimbal/target/local" to="/atl/gimbal/target/local" />
    <remap from="/prototype/gimbal/target/world" to="/atl/gimbal/target/world" />
  </node>

  <!-- control node -->
  <include file="$(find atl_ros)/launch/control.launch" />
  <param name="sim_mode" value="true" />
  <param name="debug_mode" value="false" />
  <param name="control_config_dir" value="$(find atl_configs)/configs/quadrotor_gazebosim" />

  <!-- apriltag node -->
  <include file="$(find atl_ros)/launch/apriltag.launch" />
  <param name="sim_mode" value="true" />
  <param name="debug_mode" value="false" />
  <param name="apriltag_config" type="str" value="$(find atl_configs)/configs/apriltag/prototype.yaml" />
  <remap from="/atl/gimbal/track" to="/prototype/gimbal/track" />
  <remap from="/atl/camera/image" to="/prototype/camera/image" />
</launch>
